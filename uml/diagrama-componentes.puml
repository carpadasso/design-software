@startuml

' --- ESTILIZAÇÃO GERAL ---
skinparam componentStyle uml2
skinparam defaultFontName "Segoe UI, Arial"
skinparam linetype ortho
skinparam roundCorner 10

' Aumentei o espaçamento para evitar colisão de linhas
skinparam nodesep 120
skinparam ranksep 80

' Cores Suaves
skinparam component {
    BackgroundColor<<Frontend>> #E3F2FD
    BorderColor<<Frontend>> #1565C0
    
    BackgroundColor<<Gateway>> #F3E5F5
    BorderColor<<Gateway>> #7B1FA2

    BackgroundColor<<Service>> #E8F5E9
    BorderColor<<Service>> #2E7D32

    BackgroundColor<<Database>> #FFF3E0
    BorderColor<<Database>> #EF6C00
}

title Arquitetura "Seu Cantinho" (Alinhamento Forçado)

' --- COMPONENTES ---

package "Cliente" {
    [Frontend (Web App)] as AppCliente <<Frontend>>
}

package "Roteamento" {
    [API Gateway] as Gateway <<Gateway>>
}

package "Microsserviços (Backend)" {
    ' O COMANDO MÁGICO: 'together' força o agrupamento visual antes de desenhar setas
    together {
        [Serviço de\nUsuários] as SvcUsuarios <<Service>>
        [Serviço de\nReservas] as SvcReservas <<Service>>
        [Serviço de\nEspaços] as SvcEspacos <<Service>>
        [Serviço de\nPagamentos] as SvcPagamentos <<Service>>
    }
}

package "Persistência (Dados)" {
    ' Alinhando DBs também para ficar simétrico
    together {
        database "DB Usuários" as DBUsuarios <<Database>>
        database "DB Reservas" as DBReservas <<Database>>
        database "DB Espaços" as DBEspacos <<Database>>
        database "DB Pagamentos" as DBPagamentos <<Database>>
    }
}

' --- ALINHAMENTO ESTRUTURAL (HIDDEN) ---
' Estas linhas invisíveis definem o esqueleto do diagrama

' 1. Vertical Central (Espinha dorsal)
AppCliente -[hidden]down- Gateway
Gateway -[hidden]down- SvcReservas
SvcReservas -[hidden]down- DBReservas

' 2. Horizontal (Ordem dos Serviços)
SvcUsuarios -[hidden]right- SvcReservas
SvcReservas -[hidden]right- SvcEspacos
SvcEspacos -[hidden]right- SvcPagamentos

' 3. Horizontal (Ordem dos Bancos - Espelhando os serviços)
DBUsuarios -[hidden]right- DBReservas
DBReservas -[hidden]right- DBEspacos
DBEspacos -[hidden]right- DBPagamentos

' --- CONEXÕES LÓGICAS ---

' Frontend -> Gateway
AppCliente --> Gateway

' Gateway -> Serviços
' DICA: Conectamos nas "portas" de cima (up) para não cruzar com as laterais
Gateway -down-> SvcUsuarios
Gateway -down-> SvcReservas
Gateway -down-> SvcEspacos
Gateway -down-> SvcPagamentos

' Lógica de Negócios (Serviço -> Serviço)
' Reservas valida Usuário (Esquerda)
SvcReservas -left-> SvcUsuarios : Valida

' Reservas consulta Espaço (Direita - Vizinho)
SvcReservas -right-> SvcEspacos : Consulta

' Reservas inicia Pagamento (Direita - Pula um componente)
' O Ortho vai tentar passar por baixo ou por cima
SvcReservas -right-> SvcPagamentos : Cobrança

' Callback Pagamento -> Reserva
SvcPagamentos .up.> SvcReservas : Confirmação

' Conexão com Banco de Dados (Sempre para baixo)
SvcUsuarios -down-> DBUsuarios
SvcReservas -down-> DBReservas
SvcEspacos -down-> DBEspacos
SvcPagamentos -down-> DBPagamentos

@enduml
@startuml

' Diagrama 3: Processamento de Pagamento (e Confirmação da Reserva)
autonumber
skinparam sequenceArrowThickness 2
skinparam participantPadding 10
skinparam boxPadding 10

actor "Cliente (Dona Maria)" as Cliente
participant "API Gateway" as Gateway
participant "Serviço de Pagamentos" as SvcPagamentos
participant "Serviço de Reservas" as SvcReservas
database "DB (Pagamentos)" as DBPagamentos
database "DB (Reservas)" as DBReservas

Cliente -> Gateway : POST /pagamentos/{id}/confirmar\n(status: "sinal pago" ou "quitado")
activate Gateway
Gateway -> SvcPagamentos : POST /pagamentos/{id}/confirmar
activate SvcPagamentos

' 1. Atualizar Pagamento
SvcPagamentos -> DBPagamentos : Atualiza status para "PAGO" ou "QUITADO"
activate DBPagamentos
DBPagamentos --> SvcPagamentos : (Sucesso, retorna IdReserva associado)
deactivate DBPagamentos

' 2. Notificar Serviço de Reservas (Comunicação Síncrona via REST)
note left of SvcPagamentos : Comunicação via API REST, como\n exige o trabalho[cite: 26].
SvcPagamentos -> SvcReservas : PATCH /reservas/{id_reserva}/status\n(body: "CONFIRMADA")
activate SvcReservas

' 3. Atualizar Reserva
SvcReservas -> DBReservas : Atualiza status da reserva para "CONFIRMADA"
activate DBReservas
DBReservas --> SvcReservas : (Sucesso)
deactivate DBReservas

SvcReservas --> SvcPagamentos : 200 OK
deactivate SvcReservas
SvcPagamentos --> Gateway : 200 OK (Pagamento confirmado)
deactivate SvcPagamentos
Gateway --> Cliente : 200 OK
deactivate Gateway

@enduml